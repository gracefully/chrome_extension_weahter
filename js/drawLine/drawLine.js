(function($){$.fn.drawLine=function(temps){return new drawLine(this,temps)};var drawLine=(function(el,temps){var drawLine=function(el,temps){this.container=el;if(typeof temps!="undefined"){this.temps=temps}this.init()};drawLine.prototype={container:"",temps:[],width:540,height:64,lineCanvas:"",line2DContext:"",lineColor:[255,255,255,0.1],pointColor:{"low":[51,241,243,1],"high":[229,60,55,1]},init:function(){var self=this;if(self.temps.length>0){self.lineCanvas=$('<canvas width="'+self.width+'" height="'+self.height+'"></canvas>').get(0);self.line2DContext=self.lineCanvas.getContext("2d");self.draw();self.container.css("backgroundImage","url("+self.lineCanvas.toDataURL()+")")}},draw:function(){var self=this;var unitWidth=parseInt(self.width/5);var unitSpace=parseInt(0.4*unitWidth);var maxTemp=0;var minTemp=999999;for(var i=0;i<self.temps.length;i++){if(self.temps[i]>maxTemp){maxTemp=self.temps[i]}if(self.temps[i]<minTemp){minTemp=self.temps[i]}}var unitPx=maxTemp-minTemp==0?0:(self.height-20)/(maxTemp-minTemp);self.line2DContext.strokeStyle=self.getColor(self.lineColor[0],self.lineColor[1],self.lineColor[2],self.lineColor[3]);self.line2DContext.lineWidth=1.5;self.line2DContext.beginPath();self.line2DContext.save();self.line2DContext.translate(unitSpace,self.height-10);for(var i=0;i<self.temps.length;i++){self.line2DContext.lineTo(i*unitWidth-5,-1*parseInt((self.temps[i]-minTemp)*unitPx));self.line2DContext.moveTo(i*unitWidth+5,-1*parseInt((self.temps[i]-minTemp)*unitPx))}self.line2DContext.stroke();for(var i=0;i<self.temps.length;i++){var point=self.line2DContext.createRadialGradient(i*unitWidth,-1*parseInt((self.temps[i]-minTemp)*unitPx),0,i*unitWidth,-1*parseInt((self.temps[i]-minTemp)*unitPx),3);point.addColorStop(0,"#FFFFFF");var pointColor=self.pointColor['high'];if(self.temps[i]<=0){pointColor=self.pointColor['low']}point.addColorStop(1,self.getColor(pointColor[0],pointColor[1],pointColor[2],pointColor[3]));self.line2DContext.fillStyle=point;self.line2DContext.beginPath();self.line2DContext.arc(i*unitWidth,-1*parseInt((self.temps[i]-minTemp)*unitPx),3,0,Math.PI*2,true);self.line2DContext.closePath();self.line2DContext.fill()}self.line2DContext.restore()},getColor:function(r,g,b,rate){var self=this;return"rgb("+self.processColor(r,rate)+","+self.processColor(g,rate)+","+self.processColor(b,rate)+")"},processColor:function(ele,rate){return parseInt(ele+(255-ele)*(1-rate))}};return drawLine})()})(jQuery);