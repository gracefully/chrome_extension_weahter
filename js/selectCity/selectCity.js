(function($){$.fn.selectCity=function(fn){return new selectCity(this,fn)};var selectCity=(function(el,fn){var selectCity=function(el,fn){this.container=el;if(typeof fn!="undefined"){this.callback=fn}this.init()};selectCity.prototype={container:"",provinces:[{"id":"00","name":"自动"},{"id":"01","name":"北京"},{"id":"02","name":"上海"},{"id":"03","name":"天津"},{"id":"04","name":"重庆"},{"id":"05","name":"黑龙江"},{"id":"06","name":"吉林"},{"id":"07","name":"辽宁"},{"id":"08","name":"内蒙古"},{"id":"09","name":"河北"},{"id":"10","name":"山西"},{"id":"11","name":"陕西"},{"id":"12","name":"山东"},{"id":"13","name":"新疆"},{"id":"14","name":"西藏"},{"id":"15","name":"青海"},{"id":"16","name":"甘肃"},{"id":"17","name":"宁夏"},{"id":"18","name":"河南"},{"id":"19","name":"江苏"},{"id":"20","name":"湖北"},{"id":"21","name":"浙江"},{"id":"22","name":"安徽"},{"id":"23","name":"福建"},{"id":"24","name":"江西"},{"id":"25","name":"湖南"},{"id":"26","name":"贵州"},{"id":"27","name":"四川"},{"id":"28","name":"广东"},{"id":"29","name":"云南"},{"id":"30","name":"广西"},{"id":"31","name":"海南"},{"id":"32","name":"香港"},{"id":"33","name":"澳门"},{"id":"34","name":"台湾"}],callback:function(){},init:function(){var self=this;self.container.append(self.getProvinces());self.container.append('<input type="hidden" id="cityCode" value="" cityName="">');self.container.append($('<input type="button" value=" 增 加 " class="addButton"/>').bind("click",function(){$(this).parent().find(".provinceSelect").nextAll('select').remove();$(this).parent().find(".provinceSelect").find("option[value='00']").attr("selected",true);self.callback([self.container.find("#cityCode").val()==""?0:self.container.find("#cityCode").val(),self.container.find("#cityCode").attr("cityName")==""?"自动":self.container.find("#cityCode").attr('cityName')]);self.container.find('#cityCode').val('');self.container.find('#cityCode').attr('cityName','')}))},getProvinces:function(){var self=this;var provinceSelectObj=$('<select class="provinceSelect"></select>');for(var i=0;i<self.provinces.length;i++){provinceSelectObj.append('<option value="'+self.provinces[i]['id']+'">'+self.provinces[i]['name']+'</option>')}provinceSelectObj.bind("change",function(){$(this).nextAll('select').remove();self.container.find('#cityCode').val('');self.container.find('#cityCode').attr('cityName','');self.getCitys($(this),this.value)});return provinceSelectObj},getCitys:function(obj,pid){var self=this;if(pid!='00'){$.ajax({url:"http://hao.weidunewtab.com/tianqi/city/index.php?pid="+pid,timeout:3000,dataType:"json",success:function(result){if(result[pid]&&result[pid]['data']){var citySelectObj=$('<select class="citySelect"></select>');citySelectObj.append('<option value="">自动选择</option>');$.each(result[pid]['data'],function(k,v){citySelectObj.append('<option value="'+k+'">'+v.name+'</option>')});citySelectObj.bind("change",function(){$(this).nextAll('select').remove();self.container.find('#cityCode').val('');self.container.find('#cityCode').attr('cityName','');self.getCounty($(this),this.value)});obj.after(citySelectObj)}},error:function(){showErrorMsg(getI18nMsg("cityFail"))}})}},getCounty:function(obj,cid){var self=this;if(cid){var pid=cid.substr(0,2);if(pid!='00'){$.ajax({url:"http://hao.weidunewtab.com/tianqi/city/index.php?pid="+pid,dataType:"json",timeout:3000,success:function(result){if(result[pid]&&result[pid]['data']&&result[pid]['data'][cid]&&result[pid]['data'][cid]['data']){var countySelectObj=$('<select class="countySelect"></select>');countySelectObj.append('<option value="">自动选择</option>');$.each(result[pid]['data'][cid]['data'],function(k,v){countySelectObj.append('<option value="'+v.data+'">'+v.name+'</option>')});countySelectObj.bind("change",function(){if($(this).find("option[value='"+this.value+"']").html()=="自动选择"){self.container.find('#cityCode').val("");self.container.find('#cityCode').attr('cityName',"")}else{self.container.find('#cityCode').val(this.value);self.container.find('#cityCode').attr('cityName',$(this).find("option[value='"+this.value+"']").html())}});obj.after(countySelectObj)}},error:function(){showErrorMsg(getI18nMsg("cityFail"))}})}}}};return selectCity})()})(jQuery);